<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md0"></a>
explain_sec1 Introduction</h1>
<p>This document adds to the intergration of how to build and run the project. </p>
<h1><a class="anchor" id="autotoc_md1"></a>
explain_sec2 Building the project</h1>
<p>To run the project, the cmake file is needed along with the fftw library. Currently running cmake will generate the makefile needed to build the project.</p>
<dl class="section note"><dt>Note</dt><dd>Currently the code is set on a loop such that it will grab 10 frames from the IQ file and turn them to hdf5 files. The files are stored under the database folder.</dd></dl>
<h1><a class="anchor" id="autotoc_md2"></a>
Functions explained</h1>
<p>The IQ file reading will not be covered here since the plan is to replace the IQ file with a buffer providing active feedback through a UDP server. The app will run and capture samples when given the command from the xApp to do so.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
SFFT</h2>
<p>The SFFT function is used to transform the IQ data into the frequency domain. The function is called with the IQ data and the size of the data. The first portion of the code calculates the proper window size to maintain a resoultion of equal measure across both frequency and time domain. The frequency resolution can be given by the formula </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac{f_s}{M} \]" src="form_0.png" width="15" height="28"/>
</p>
<p> where N is the length of the window and <img class="formulaInl" alt="$f_s$" src="form_1.png" width="10" height="13"/> is the sample rate. Within a 5G signal it is cut into discreate chunks of SCS (Subcarrier Spacing) and since the signal is cyclic prefix it will repeat to space each signal since it using OFDM (Orthogonal Frequency Division Multiplexing). A table was made for ease of reference.</p>
<p>A single slot contains 14 OFDM symbols meaning that the depending on SCS the formula to determine the smallest unit in time domain is <img class="formulaInl" alt="$ \frac{slot_{time}}{14} $" src="form_2.png" width="38" height="18"/> with the inverse being the smallest possible dicreate. in the frequency domain.</p>
<p>The window length to make claculation faster is all powers of 2 which to save on calculation time, a LUT is created with</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> windowSizeLUT[7] = {64, 128, 256, 512, 1024, 2048, 4096};</div>
</div><!-- fragment --><p> Since the maximum frequency resolution is dependent on the bandwidth an algorigthmic method is needed to determine the</p>
<p>For 40 MHz</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">SCS   </th><th class="markdownTableHeadNone">Slot Time   </th><th class="markdownTableHeadCenter">Max Frequency Resolution   </th><th class="markdownTableHeadNone">Max Time Resolution    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">15   </td><td class="markdownTableBodyNone">1ms   </td><td class="markdownTableBodyCenter">14kHz   </td><td class="markdownTableBodyNone"><img class="formulaInl" alt="$\frac{1}{14k}$" src="form_3.png" width="18" height="16"/>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">30   </td><td class="markdownTableBodyNone">0.5ms   </td><td class="markdownTableBodyCenter">28Khz   </td><td class="markdownTableBodyNone"><img class="formulaInl" alt="$\frac{1}{28k}$" src="form_4.png" width="18" height="16"/>   </td></tr>
</table>
<p>The max number of samples within a resource block will vary greatly depending on the SCS to avoid the max resolution in a single domain the window length should be to capture within at least 30 subframes. The window length is calculated by the following formula <img class="formulaInl" alt="$ \frac{f_s}{M} $" src="form_5.png" width="13" height="18"/> where <img class="formulaInl" alt="$ f_s $" src="form_6.png" width="10" height="13"/> is the sample rate and <img class="formulaInl" alt="$ M $" src="form_7.png" width="14" height="10"/> is the window length.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (signalIndex &lt; iq.size())</div>
<div class="line">         {</div>
<div class="line">             std::complex&lt;double&gt; windowSample = iq[signalIndex] * window[j];</div>
<div class="line">             in[i * windowSize + j][0] = std::real(windowSample);</div>
<div class="line">             in[i * windowSize + j][1] = std::imag(windowSample);</div>
<div class="line">         }</div>
</div><!-- fragment --><p>This portion of the code is used to create the windowed samples to be used in the FFT. The windowed samples are then stored in the in array, which allows for the FFT to be performed. The fftw function used is</p>
<div class="fragment"><div class="line">p = fftw_plan_dft_1d(windowSize, in, out, FFTW_FORWARD, FFTW_ESTIMATE);</div>
</div><!-- fragment --><p>The output of the FFT is then stored in the out array. Only half of the out array is stored to avoid redundancy. The output is then stored in the fftData array. Since we take the absolute value of the complex number, the struct contains two extra vectors which are the <a class="el" href="structstft.html">stft</a> structure.</p>
<p>The way the data is stored within the first array as a absolute value with the power in dB which creates ease of use and reference as a comparsion for debugging purposes. </p><dl class="section note"><dt>Note</dt><dd>Later editions will remove this to save on memory and go straight to the CIR</dd></dl>
<h1><a class="anchor" id="autotoc_md4"></a>
Running the application</h1>
<p>The executable will convert all the named binary file from the IQ folder to the database folder as a hdf5 file. The hdf5 file is simple in structure as a 2D array with the rows and coloumns serving as the window and frequency bins respectivly.</p>
<ol type="1">
<li>Run the cmake file to generate the makefile <div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
</div><!-- fragment --></li>
<li>Run the makefile to build the project</li>
<li>Run the executable to convert the binary files to hdf5 files. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
